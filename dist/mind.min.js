!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Mind=e()}(this,function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?h(t):e}function u(t,e){var i=t.listenerMap;return!i&&e&&(i=t.listenerMap={}),i}function d(t,e){var i=u(t);return i&&i[e]}function f(t,e){var i=u(t);i&&delete i[e]}function p(t){return t.split(".")[0]}function g(e,t){var i=d(e,t),n=p(t);if(i){i.forEach(function(t){e.removeEventListener(n,t)}),f(e,t);var o=u(e);Object.keys(o).length||delete e.listenerMap}}function v(t,e,i){var n=p(e);t.addEventListener(n,i);var o=u(t,!0),r=o[e];r||(r=o[e]=[]),r.push(i)}function m(t,e,i){u(t)&&(i?function(t,e,i){var n=p(e);t.removeEventListener(n,i);var o=d(t,e);if(o){var r=o.findIndex(function(t){return t===i});-1!==r&&o.splice(r,1),o.length||f(t,e)}}(t,e,i):e?g(t,e):function(t){var e=u(t);if(e)for(var i in e)g(t,i)}(t))}var y=document,k=("undefined"==typeof HTMLElement||e(HTMLElement),["width","height","fontSize","borderRadius","padding","left","right","top","bottom","borderWidth","maxWidth"]),b=function(t,e){for(var i in e)"padding"===i?t.style.padding="".concat(e.padding[0],"px ").concat(e.padding[1],"px"):t.style[i]=k.includes(i)?"".concat(e[i],"px"):e[i]},w=["svg","g","path"],L=function(t,e,i){var n;for(var o in n=w.includes(t)?y.createElementNS("http://www.w3.org/2000/svg",t):y.createElement(t),e)n.setAttribute(o,e[o]);return i&&i.appendChild(n),n},$=function(t,e){return t.className.split(" ").includes(e)},C=function(e,t){if(e&&t){var i=e.className;t.split(" ").forEach(function(t){t&&(e.classList?e.classList.add(t):$(e,t)||(i+=" "+t))}),e.classList||(e.className=i)}},M=function(t,e){if(t&&e){for(var i=e.split(" "),n=" "+t.className+" ",o=0,r=i.length;o<r;o++){var s=i[o];s&&(t.classList?t.classList.remove(s):$(t,s)&&(n=n.replace(" "+s+" "," ")))}t.classList||(t.className=trim(n))}},N=document,t=function(){function e(t){o(this,e),a(this,"root",null),a(this,"$container",null),a(this,"$el",null),a(this,"options",null),a(this,"scale",1),a(this,"dragingFlag",!1),this.root=t,this.$container=t.$el,this.options=t.options,this.create(),this.setStyle(),this.moveToCenter(),this.initEvents()}return r(e,[{key:"create",value:function(){this.$el=L("div",{class:"mind-designer"},this.$container),this.$view=L("div",{class:"mind-viewport"},this.$el)}},{key:"setStyle",value:function(){var t=this.options,e=t.width,i=t.height,n=t.backgroundColor;b(this.$el,{width:e,height:i,backgroundColor:n})}},{key:"moveTo",value:function(t,e){this.$container.scrollLeft=t,this.$container.scrollTop=e}},{key:"moveToCenter",value:function(){var t=this.$container.getBoundingClientRect(),e=t.width,i=t.height,n=this.options,o=n.width,r=n.height;this.moveTo((o-e)/2,(r-i)/2)}},{key:"initEvents",value:function(){v(this.$el,"mousedown.dragmove",this.onDragStart.bind(this))}},{key:"onDragStart",value:function(t){t.stopPropagation();var e=t.pageX,i=t.pageY,n=this.$container,o=n.scrollLeft,r=n.scrollTop;this.dragStartMousePosition={pageX:e,pageY:i},this.dragStartScroll={scrollLeft:o,scrollTop:r},v(N,"mousemove.dragmove",this.onDraging.bind(this)),v(N,"mouseup.dragmove",this.onDragEnd.bind(this))}},{key:"onDraging",value:function(t){t.stopPropagation();var e=this.dragStartScroll,i=e.scrollLeft,n=e.scrollTop,o=this.dragStartMousePosition,r=o.pageX,s=o.pageY,a=i-t.pageX+r,l=n-t.pageY+s;this.moveTo(a,l),this.dragingFlag||(C(this.$el,"mind-no-event"),this.dragingFlag=!0)}},{key:"onDragEnd",value:function(t){m(N,"mousemove.dragmove"),m(N,"mouseup.dragmove"),this.dragingFlag=!1,M(this.$el,"mind-no-event")}},{key:"zoom",value:function(t){this.scale=t||1,b(this.$el,{transform:"scale(".concat(this.scale,")")})}},{key:"zoomIn",value:function(){var t=this.options,e=t.zoomMax,i=t.zoomStep;this.zoom(Math.min(this.scale+i,e))}},{key:"zoomOut",value:function(){var t=this.options,e=t.zoomMin,i=t.zoomStep;this.zoom(Math.max(this.scale-i,e))}},{key:"getZoom",value:function(){return this.scale}}]),e}(),P={lineColor:["#FDB813","#80BC42","#e85d4e","#127c97","#ffcccc","#67ccff"],type:"org",width:2e4,height:2e4,draggable:!1,showConnectionLabel:!0,showTooltip:!0,tooltipDelay:500,tooltipFormat:null,backgroundColor:"#fff",zoomMax:2,zoomMin:.4,zoomStep:.15,rootMargin:80,branchMargin:20,branchShowIndex:!1,flowNodeMarginW:200,flowNodeMarginH:60,flowRootMargin:200,normalLineStyle:{stroke:"rgb(58, 169, 206)",strokeWidth:1,strokeLinecap:"square",fill:"none"},linkLineStyle:{stroke:"rgb(113, 203, 45)",strokeWidth:2,strokeLinecap:"square",strokeLinejoin:"round",fill:"none",type:"curve",direction:"horizontal"},onNodeClick:null};"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var E,x,S,T=(function(t,e){t.exports=function(){var s=function(t){return!(!(n=t)||"object"!=typeof n||(e=t,"[object RegExp]"===(i=Object.prototype.toString.call(e))||"[object Date]"===i||e.$$typeof===o));var e,i,n},o="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function a(t,e){return!1!==e.clone&&e.isMergeableObject(t)?r((i=t,Array.isArray(i)?[]:{}),t,e):t;var i}function l(t,e,i){return t.concat(e).map(function(t){return a(t,i)})}function h(e,i,n){var o={};return n.isMergeableObject(e)&&Object.keys(e).forEach(function(t){o[t]=a(e[t],n)}),Object.keys(i).forEach(function(t){n.isMergeableObject(i[t])&&e[t]?o[t]=function(t,e){if(!e.customMerge)return r;var i=e.customMerge(t);return"function"==typeof i?i:r}(t,n)(e[t],i[t],n):o[t]=a(i[t],n)}),o}function r(t,e,i){(i=i||{}).arrayMerge=i.arrayMerge||l,i.isMergeableObject=i.isMergeableObject||s;var n=Array.isArray(e),o=Array.isArray(t),r=n===o;return r?n?i.arrayMerge(t,e,i):h(t,e,i):a(e,i)}return r.all=function(t,i){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce(function(t,e){return r(t,e,i)},{})},r}()}(E={exports:{}},E.exports),E.exports),B=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e=e.filter(function(t){return!!t}),T.all(e,{arrayMerge:function(t,e){return e}})},j=("undefined"==typeof HTMLElement||e(HTMLElement),document.body),z=0,D=0,O={$el:null,init:function(){O.$el||(O.$el=L("div",{class:"mind-tooltip"}),j.appendChild(O.$el))},resetPosition:function(){if(O.$el){var t=O.$el.getBoundingClientRect(),e=t.width,i=t.height;b(O.$el,{left:z-e/2,top:D-i-4})}},show:function(t){O.$el||O.init(),t?x=setTimeout(function(){C(O.$el,"show"),O.resetPosition()},t):(C(O.$el,"show"),O.resetPosition())},hide:function(){O.$el&&(x&&(clearTimeout(x),x=null),M(O.$el,"show"),O.$el.style.left="",O.$el.style.top="")},setContent:function(t){O.$el||O.init(),O.$el.innerHTML=t},setPosition:function(t,e){z=t,D=e},destroy:function(){O.$el=null;var t=document.body.querySelector(".mind-tooltip");t&&t.parentNode.removeChild(t)}},A=document,R=function(){function i(t,e){o(this,i),a(this,"$container",null),a(this,"$el",null),a(this,"viewport",null),this.$container="string"==typeof t?A.querySelector(t):t,this.options=B(P,e),this.create(),this.createViewport(),O.destroy()}return r(i,[{key:"create",value:function(){this.$el=L("div",{class:"mind-container"},this.$container)}},{key:"createViewport",value:function(){this.viewport=new t(this)}},{key:"getViewportSize",value:function(){var t=this.options;return{width:t.width,height:t.height}}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"destroy",value:function(){var t=this.$el.parentNode;t&&t.removeChild(this.$el)}}]),i}(),W={name:null,className:null,icon:null,href:null,draggable:!1,showTooltip:!1,tooltipDelay:500,tooltipFormat:function(t){return t.config.name}},F=function(){function e(t){o(this,e),this.config=B(W,t),this.init(),this.initEvents()}return r(e,[{key:"init",value:function(){var t=this.config,e=t.name,i=t.className,n=t.icon,o=t.href,r=t.draggable,s="mind-node";s+=i?" "+i:"";var a=L("div",{class:s+=r?" draggable":""}),l="";n&&(l+='<i class="'.concat(n,'"></i>')),l+='<span class="mind-node-inner">'.concat(e,"</span>"),o&&(l+='<a href="'.concat(o,'" class="mind-link iconfont icon-link" target="_blank"></a>')),a.innerHTML=l,this.$el=a}},{key:"initEvents",value:function(){v(this.$el,"mouseenter.nodehover",this.onMouseEnter.bind(this)),v(this.$el,"mouseleave.nodehover",this.onMouseLeave.bind(this))}},{key:"render",value:function(t,e){this.setPosition(e),t.appendChild(this.$el)}},{key:"onMouseEnter",value:function(){var t=this.config,e=t.showTooltip,i=t.tooltipFormat,n=t.tooltipDelay;if(e&&i&&!this.isDragging){var o=i(this);if(o){var r=this.$el.getBoundingClientRect(),s=r.width,a=r.left,l=r.top;O.setContent(o),O.setPosition(a+s/2,l),O.show(n)}}}},{key:"onMouseLeave",value:function(){O.hide()}},{key:"getBoundRect",value:function(){return this.$el.getBoundingClientRect()}},{key:"setPosition",value:function(t){var e=t.left,i=t.top;b(this.$el,{left:e,top:i})}},{key:"setStyle",value:function(t){b(this.$el,t)}},{key:"setDrag",value:function(t){(this.isDragging=t)&&O.hide()}},{key:"getPosition",value:function(){return{left:parseInt(this.$el.style.left,10),top:parseInt(this.$el.style.top,10)}}},{key:"changeClass",value:function(t,e){C(this.$el,t),M(this.$el,e)}},{key:"destroy",value:function(){var t=this.$el.parentNode;m(this.$el,"mouseenter.nodehover"),m(this.$el,"mouseleave.nodehover"),t&&t.removeChild(this.$el)}}]),e}(),_=function(){function e(t){o(this,e),a(this,"$el",null),a(this,"options",{start:[],end:[],radius:4,stroke:"#43a9ff",strokeWidth:1,fill:"none",strokeLinecap:"square"}),Object.assign(this.options,t),this.create()}return r(e,[{key:"create",value:function(){var t,e=this.options,i=e.start,n=e.end,o=e.radius,r=e.stroke,s=e.strokeWidth,a=e.strokeLinecap,l=e.fill,h=i[0],c=i[1],u=n[0],d=n[1];if(Math.abs(c-d)<o)t=["M",h,c,"L",u,d];else{var f=h<u&&d<c||u<h&&c<d?1:0,p=(h+u)/2,g=h<u?Math.min(p+o,u):Math.max(p-o,u);t=["M",h,c,"L",p,c,"L",p,c<d?Math.max(c,d-o):Math.min(c,d+o),"A",o,o,0,0,f,g,d,"L",u,d]}this.$el=L("path",{d:t.join(" "),stroke:r,"stroke-width":s,"stroke-linecap":a,fill:l})}}]),e}(),q=function(){function s(t){o(this,s),a(this,"options",{mind:null,parent:null,structure:"right",data:null}),a(this,"mind",null),a(this,"$el",null),a(this,"$topicBox",null),a(this,"$expandBox",null),a(this,"$pathBox",null),a(this,"$pathGroup",null),a(this,"node",null),a(this,"parent",null),a(this,"children",[]),a(this,"isExpand",!0),Object.assign(this.options,t),this.parent=this.options.parent,this.mind=this.options.mind,this.isExpand=!1!==t.data.expand,this.create()}return r(s,[{key:"render",value:function(){var t=this.children;t.length&&(this.isExpand&&this.drawLines(),t.forEach(function(t){t.render()}))}},{key:"create",value:function(){var t=this.options,e=t.data,i=t.structure;this.$el=L("div",{class:"mind-topic-container mind-topic-".concat(i," ").concat(this.isExpand?"is-expand":"")}),this.createNode(),e.children&&e.children.length&&(this.createChildren(),this.createPaths(),this.createExpand())}},{key:"createNode",value:function(){var t=this.parent,e=this.options,i=this.$topicBox=L("div",{class:"mind-topic-box"},this.$el);"root"===e.structure||t&&t.options.structure,this.node=new F(this.getNodeConfig(e.data)),i.appendChild(this.node.$el)}},{key:"createExpand",value:function(){this.$expandBox=L("span",{class:"mind-expand-box"},this.$topicBox)}},{key:"createChildren",value:function(){var i=this,t=this.options,e=t.data,n=t.structure,o=e.children,r=L("div",{class:"mind-topic-children"});this.children=o.map(function(t){var e=new s({mind:i.mind,parent:i,structure:n,data:t});return r.appendChild(e.$el),e}),"left"===n?this.$el.insertBefore(r,this.$topicBox):this.$el.appendChild(r)}},{key:"createPaths",value:function(){var t=this.$pathBox=L("svg",{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},this.$el);this.$pathGroup=L("g",null,t)}},{key:"getNodeConfig",value:function(t){var e=this.options.mind.options,i=e.draggable,n=e.showTooltip,o=e.tooltipFormat,r=e.tooltipDelay;return Object.assign({draggable:i,showTooltip:n,tooltipFormat:o,tooltipDelay:r},t)}},{key:"setPosition",value:function(t,e){b(this.$el,{left:t,top:e})}},{key:"getPosition",value:function(){return{left:parseInt(this.$el.style.left,10),top:parseInt(this.$el.style.top,10)}}},{key:"getSize",value:function(){return this.$el.getBoundingClientRect()}},{key:"drawLines",value:function(){var r=this,s=this.mind.getZoom(),a=this.options.structure,l=this.getSize(),h=this.getLineStartPos();this.children.forEach(function(t){var e=t.getSize(),i=(e.top-l.top+e.height/2)/s,n=("left"===a?e.right-l.left:e.left-l.left)/s,o=new _({start:[h.left/s,h.top/s],end:[n,i]});r.$pathGroup.appendChild(o.$el)})}},{key:"updateConnections",value:function(){this.children.length&&(this.$pathGroup.innerHTML="",this.isExpand&&this.drawLines())}},{key:"updateParentConnections",value:function(){var t=this.parent;t&&(t.updateConnections(),t.updateParentConnections())}},{key:"updateChildConnections",value:function(){this.children.forEach(function(t){t.updateConnections(),t.updateChildConnections()})}},{key:"getLineStartPos",value:function(){var t=this.options.structure,e=this.getSize(),i=this.node.getBoundRect(),n=i.top-e.top+i.height/2;return{left:"left"===t?i.left-e.left:i.left-e.left+i.width,top:n}}},{key:"triggerExpand",value:function(){this.isExpand=!this.isExpand,this.isExpand?C(this.$el,"is-expand"):M(this.$el,"is-expand"),this.getRootTopic().resetPosToCenter(),this.updateParentConnections(),this.updateConnections(),this.updateChildConnections()}},{key:"getRootTopic",value:function(){for(var t=this;t.parent;)t=t.parent;return t}}]),s}(),X=function(){function e(t){o(this,e),a(this,"$el",null),a(this,"options",{type:"quadratic",start:[],end:[],quadraticWidth:10,stroke:"#43a9ff",strokeWidth:2,fill:"none",strokeLinecap:"square"}),Object.assign(this.options,t),this.create()}return r(e,[{key:"create",value:function(){switch(this.options.type){case"gradient":this.createGradientCurve()}}},{key:"createGradientCurve",value:function(){var t,e=this.options,i=e.start,n=e.end,o=e.quadraticWidth,r=e.stroke,s=e.strokeWidth,a=e.strokeLinecap,l=e.fill,h=i[0],c=i[1],u=n[0],d=n[1];if(Math.abs(d-c)<o){var f=Math.atan((d-c)/(u-h)),p=Math.sin(f)*o/2,g=Math.cos(f)*o/2,v=h+p,m=c-g;t=["M",v,m,"L",u,d,"L",h-p,c+g,"L",v,m]}else{var y=.2*(u-h)+h,k=d,b=h<u&&c<d||u<h&&d<c?-o:o,w=Math.atan((k-c)/(y-h)),$=Math.sin(w)*o/2,C=Math.cos(w)*o/2,M=h+$,N=c-C,P=h-$,E=c+C;t=["M",M,N,"C",M,N,y,k,u,d,"C",y+b,k,P,E,P,E,"L",M,N,"Z"]}this.$el=L("path",{d:t.join(" "),stroke:r,"stroke-width":s,"stroke-linecap":a,fill:l})}}]),e}(),G=function(t){function i(t){var e;return o(this,i),a(h(e=c(this,l(i).call(this,t))),"centerPosX",null),a(h(e),"centerPosY",null),e}return s(i,q),r(i,[{key:"createChildren",value:function(){var t=this.options.data,e=t.children,i=t.leftChildren,n=L("div",{class:"mind-topic-children"}),o=this.createChildrenByStructure(e,"right",n),r=this.createChildrenByStructure(i,"left",n);this.children=o.concat(r),this.$el.appendChild(n)}},{key:"createChildrenByStructure",value:function(t,i,n){var o=this;return t?t.map(function(t){var e=new q({mind:o.mind,parent:o,structure:i,data:t});return n.appendChild(e.$el),e}):[]}},{key:"render",value:function(){this.mind.viewport.$view.appendChild(this.$el),this.resetPosToCenter(),this.drawLines(),this.children.forEach(function(t){t.render()})}},{key:"resetPosToCenter",value:function(){this.resetNodePos(),this.resetChildTopicPos("left"),this.resetChildTopicPos("right")}},{key:"resetNodePos",value:function(){var t=this.mind.getZoom(),e=this.node.getBoundRect(),i=e.width,n=e.height,o=this.mind.getViewportSize(),r=o.width,s=o.height,a=(r-i/t)/2,l=(s-n/t)/2;this.centerPosX=r/2,this.centerPosY=s/2,b(this.$topicBox,{left:a,top:l})}},{key:"resetChildTopicPos",value:function(o){var r=this,s=this.mind.getZoom(),a=this.node.getBoundRect().width,t=this.mind.options,l=t.rootMargin,h=t.branchMargin,c=this.children.filter(function(t){return t.options.structure===o}),e=c.map(function(t){return t.getSize()}),i=e.reduce(function(t,e){return t+e.height/s},0);i+=(c.length-1)*h;var u=this.centerPosY-i/2;e.forEach(function(t,e){var i=c[e],n="left"===o?r.centerPosX-a/s/2-l-t.width/s:r.centerPosX+a/s/2+l;i.setPosition(n,u),u+=t.height/s+h})}},{key:"drawLines",value:function(){var c=this,u=this.mind.getZoom(),d=this.centerPosX,f=this.centerPosY,p=this.mind.options.lineColor;this.children.forEach(function(t,e){var i=t.getSize(),n=i.width,o=i.height,r=t.getPosition(),s=r.left,a=r.top,l="left"===t.options.structure?s+n/u:s,h=new X({type:"gradient",start:[d,f],end:[l,a+o/u/2],stroke:p[e],fill:p[e]});c.$pathGroup.appendChild(h.$el)})}}]),i}(),H=0,I=0,Y={},Z={};function V(t,e,i){return"_root"==e?i:t!==i?(n=t,S||(S=n.matches?n.matches:n.webkitMatchesSelector?n.webkitMatchesSelector:n.mozMatchesSelector?n.mozMatchesSelector:n.msMatchesSelector?n.msMatchesSelector:n.oMatchesSelector?n.oMatchesSelector:Q.matchesSelector)).call(t,e)?t:t.parentNode?(H++,V(t.parentNode,e,i)):void 0:void 0;var n}function J(t,e,i,n){if(Y[t.id])if(e)if(n||i)if(n){if(Y[t.id][e][i])for(var o=0;o<Y[t.id][e][i].length;o++)if(Y[t.id][e][i][o]===n){Y[t.id][e][i].splice(o,1);break}}else delete Y[t.id][e][i];else Y[t.id][e]={};else for(var r in Y[t.id])Y[t.id].hasOwnProperty(r)&&(Y[t.id][r]={})}function K(t,e,i,n){if(this.element){t instanceof Array||(t=[t]),i||"function"!=typeof e||(i=e,e="_root");var o,r,s,a,l,h=this.id;for(o=0;o<t.length;o++)n?J(this,t[o],e,i):(Y[h]&&Y[h][t[o]]||Q.addEvent(this,t[o],c(t[o])),r=this,s=t[o],a=e,l=i,Y[r.id]||(Y[r.id]={}),Y[r.id][s]||(Y[r.id][s]={}),Y[r.id][s][a]||(Y[r.id][s][a]=[]),Y[r.id][s][a].push(l));return this}function c(e){return function(t){!function(t,e,i){if(Y[t][i]){var n,o,r=e.target||e.srcElement,s={},a=0,l=0;for(n in H=0,Y[t][i])Y[t][i].hasOwnProperty(n)&&(o=V(r,n,Z[t].element))&&Q.matchesEvent(i,Z[t].element,o,"_root"==n,e)&&(H++,Y[t][i][n].match=o,s[H]=Y[t][i][n]);for(e.stopPropagation=function(){e.cancelBubble=!0},a=0;a<=H;a++)if(s[a])for(l=0;l<s[a].length;l++){if(!1===s[a][l].call(s[a].match,e))return Q.cancel(e);if(e.cancelBubble)return}}}(h,t,e)}}}function Q(t,e){if(!(this instanceof Q)){for(var i in Z)if(Z[i].element===t)return Z[i];return Z[++I]=new Q(t,I),Z[I]}this.element=t,this.id=e}Q.prototype.on=function(t,e,i){return K.call(this,t,e,i)},Q.prototype.off=function(t,e,i){return K.call(this,t,e,i,!0)},Q.matchesSelector=function(){},Q.cancel=function(t){t.preventDefault(),t.stopPropagation()},Q.addEvent=function(t,e,i){var n="blur"==(e=e.split(".")[0])||"focus"==e;t.element.addEventListener(e,i,n)},Q.matchesEvent=function(){return!0};var U,tt=document.body,et=0,it=0,nt={$el:null,init:function(){nt.$el||(nt.$el=L("div",{class:"mind-tooltip"}),tt.appendChild(nt.$el))},resetPosition:function(){if(nt.$el){var t=nt.$el.getBoundingClientRect(),e=t.width,i=t.height;b(nt.$el,{left:et-e/2,top:it-i-4})}},show:function(t){nt.$el||nt.init(),t?U=setTimeout(function(){C(nt.$el,"show"),nt.resetPosition()},t):(C(nt.$el,"show"),nt.resetPosition())},hide:function(){nt.$el&&(U&&(clearTimeout(U),U=null),M(nt.$el,"show"),nt.$el.style.left="",nt.$el.style.top="")},setContent:function(t){nt.$el||nt.init(),nt.$el.innerHTML=t},setPosition:function(t,e){et=t,it=e},destroy:function(){nt.$el=null;var t=document.body.querySelector(".mind-tooltip");t&&t.parentNode.removeChild(t)}},ot=document,rt=function(t){function n(t,e){var i;return o(this,n),a(h(i=c(this,l(n).call(this,t,e))),"rootTopic",null),a(h(i),"topics",[]),i.initEvents(),i.render(),i}return s(n,R),r(n,[{key:"render",value:function(){this.rootTopic=new G({mind:this,structure:"root",data:this.options.data}),this.rootTopic.render(),this.topics=function e(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"children",n=[];return t instanceof Array?t.forEach(function(t){n.push(t),n=n.concat(e(t[i]))}):(n.push(t),n=n.concat(e(t[i]))),n}(this.rootTopic)}},{key:"initEvents",value:function(){Q(ot).on("click.expand",".mind-expand-box",this.triggerTopicExpand.bind(this)),Q(ot).on("click.node",".mind-node",this.onNodeClick.bind(this))}},{key:"triggerTopicExpand",value:function(t){var e=t.target.parentNode.parentNode,i=this.getTopicByElement(e);i&&i.triggerExpand()}},{key:"onNodeClick",value:function(t){for(var e=t.target;!$(e,"mind-topic-container");)e=e.parentNode;var i=this.getTopicByElement(e);i&&this.options.onNodeClick&&this.options.onNodeClick(i.options.data,i.node)}},{key:"getTopicByElement",value:function(e){return this.topics.find(function(t){return t.$el===e})}},{key:"destroy",value:function(){this.$container.removeChild(this.$el),Q(ot).off("click.expand"),Q(ot).off("click.node"),nt.destroy()}}]),n}(),st=function(){function n(t,e,i){o(this,n),a(this,"$path",null),a(this,"from",null),a(this,"to",null),a(this,"options",{type:"straight",stroke:"#43a9ff",strokeWidth:1,strokeLinecap:"square",fill:"none",direction:"horizontal"}),this.from=t,this.to=e,Object.assign(this.options,i),this.direction=this.options.direction,this.create()}return r(n,[{key:"create",value:function(){var t=this.options,e=t.stroke,i=t.strokeWidth,n=t.strokeLinecap,o=t.fill,r=this.$path=L("path",{stroke:e,"stroke-width":i,"stroke-linecap":n,fill:o});this.getPath&&r.setAttribute("d",this.getPath())}}]),n}(),at=function(t){function n(t,e,i){return o(this,n),c(this,l(n).call(this,t,e,i))}return s(n,st),r(n,[{key:"create",value:function(){var t=this.options,e={stroke:t.stroke,"stroke-width":t.strokeWidth,"stroke-linecap":t.strokeLinecap,"stroke-linejoin":t.strokeLinejoin,fill:t.fill},i=this.$path=L("g");this.$line=L("path",e,i),this.$arrow=L("path",e,i),this.$line.setAttribute("d",this.getPath()),this.$arrow.setAttribute("d",this.getArrowPath())}},{key:"update",value:function(t){var e=t.from,i=t.to,n=t.direction;this.from=e,this.to=i,this.direction=n,this.$line.setAttribute("d",this.getPath()),this.$arrow.setAttribute("d",this.getArrowPath())}},{key:"clear",value:function(){this.$line.setAttribute("d",""),this.$arrow.setAttribute("d","")}},{key:"getPath",value:function(){var t=this.from[0],e=this.from[1],i=this.to[0],n=this.to[1];if("horizontal"===this.direction){var o=.4*Math.abs(t-i);return["M",t,e,"C",i<t?t-o:t+o,e,i<t?i+o:i-o,n,i<t?i+10:i-10,n,"L",i,n].join(" ")}var r=.4*Math.abs(e-n);return["M",t,e,"C",t,n<e?e-r:e+r,i,n<e?n+r:n-r,i,n<e?n+10:n-10,"L",i,n].join(" ")}},{key:"getArrowPath",value:function(){var t,e,i=this.from[0],n=this.from[1],o=this.to[0],r=this.to[1];return e="horizontal"===this.direction?o<i?(t=[o+6,r-4],[o+6,r+4]):(t=[o-6,r-4],[o-6,r+4]):r<n?(t=[o-4,r+6],[o+4,r+6]):(t=[o-4,r-6],[o+4,r-6]),["M",o,r,"L",t[0],t[1],"M",o,r,"L",e[0],e[1],"Z"].join(" ")}}]),n}(),lt=document,ht=function(t,e){var i,n,o,r,s=(i=t,n=e,Math.max(Math.abs(i.top-n.bottom),Math.abs(n.top-i.bottom))<i.height+n.height),a=(o=t,r=e,Math.max(Math.abs(o.left-r.right),Math.abs(r.left-o.right))<o.width+r.width);if(!s||!a){if(s)return"horizontal";if(a)return"vertical";var l=Math.min(Math.abs(t.top-e.bottom),Math.abs(t.bottom-e.top));return Math.min(Math.abs(t.left-e.right),Math.abs(t.right-e.left))<l?"vertical":"horizontal"}},ct=function(t){function n(t,e){var i;return o(this,n),a(h(i=c(this,l(n).call(this,t,e))),"nodes",[]),a(h(i),"nodeTree",null),a(h(i),"$pathBox",null),a(h(i),"$pathGroup",null),a(h(i),"connections",[]),i.$viewport=i.viewport.$view,C(i.$el,"mind-flow"),i.nodeTree=i.createNode(e.data),i.nodes.forEach(function(t){var e=t.node;i.$viewport.appendChild(e.$el)}),i.createPaths(),i.createLabels(),i.setPosition(),i.createConnections(i.nodeTree),i.options.showConnectionLabel||i.hideLabel(),i.initEvents(),i}return s(n,R),r(n,[{key:"createNode",value:function(t){var o=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(t){if(t instanceof Array)return t.map(function(t){var e=o.createNode(t.parents,r-1),i=o.createNode(t.children,r+1),n={node:new F(o.getNodeConfig(t)),axis:r,parents:e,children:i};return e&&e.length?n.leaf=e.reduce(function(t,e){return t+e.leaf},0):i&&i.length?n.leaf=i.reduce(function(t,e){return t+e.leaf},0):n.leaf=1,o.nodes.push(n),n});var e={node:new F(this.getNodeConfig(t)),axis:r,parents:this.createNode(t.parents,r-1,"children",e),children:this.createNode(t.children,r+1,"parents",e)};return this.nodes.push(e),e}}},{key:"getNodeConfig",value:function(t){var e=this.options,i=e.draggable,n=e.showTooltip,o=e.tooltipFormat,r=e.tooltipDelay;return Object.assign({draggable:i,showTooltip:n,tooltipFormat:o,tooltipDelay:r},t)}},{key:"getChildNode",value:function(t){console.log(this.nodeTree);t.id}},{key:"createPaths",value:function(){var t=this.$pathBox=L("svg",{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},this.$viewport);this.$pathGroup=L("g",null,t)}},{key:"createLabels",value:function(){this.$labelContainer=L("div",{class:"mind-label-container"},this.$viewport)}},{key:"setPosition",value:function(){var t=this.options,e=t.width,i=t.height,n=this.nodeTree.node,o=n.getBoundRect(),r=o.width,s=o.height,a=e/2,l=i/2;n.setPosition({left:a-r/2,top:l-s/2}),this.setNodePosition(this.nodeTree.parents,"left",l),this.setNodePosition(this.nodeTree.children,"right",l)}},{key:"setNodePosition",value:function(t,l,h){var c=this,e=this.options,i=e.width,u=e.flowRootMargin,d=e.flowNodeMarginW,f=e.flowNodeMarginH;if(t&&t.length){var p=i/2,g=t.reduce(function(t,e){return e.leaf+t},0),v=0;t.forEach(function(t){var e,i=c.nodeTree.node.getBoundRect().width,n=t.node.getBoundRect(),o=n.width,r=n.height,s="left"===l?t.parents:t.children,a=h-(g/2-t.leaf/2-v)*f-r/2;e="left"===l?p-((Math.abs(t.axis)-1)*d+u+o/2)-i/2:p+((Math.abs(t.axis)-1)*d+u-o/2)+i/2,t.node.setPosition({left:e,top:a}),v+=t.leaf,c.setNodePosition(s,l,a+r/2)})}}},{key:"createConnections",value:function(s){var a=this,t=s.children,e=s.parents,l=this.getNodeBound(s);t&&t.forEach(function(t){var e=t.node.config.connectionLabel,i=a.getNodeBound(t),n=a.drawLink(l,i,e),o=n.line,r=n.labelEl;a.connections.push({fromNode:s.node,toNode:t.node,line:o,labelEl:r}),a.createConnections(t)}),e&&e.forEach(function(t){var e=s.node.config.connectionLabel,i=a.getNodeBound(t),n=a.drawLink(i,l,e),o=n.line,r=n.labelEl;a.connections.push({fromNode:t.node,toNode:s.node,line:o,labelEl:r}),a.createConnections(t)})}},{key:"drawLink",value:function(t,e,i){var n,o=this.options.linkLineStyle,r=[t.left+t.width,t.top+t.height/2],s=[e.left,e.top+e.height/2],a=new at(r,s,o);return this.$pathGroup.appendChild(a.$path),i&&(n=this.drawLabel(t,e,i)),{line:a,labelEl:n}}},{key:"drawLabel",value:function(t,e,i){var n=(t.left+t.width+e.left)/2,o=(t.top+t.height/2+e.top+e.height/2)/2,r=L("div",{class:"mind-label"},this.$labelContainer);r.innerText=i;var s=r.getBoundingClientRect(),a=s.width,l=s.height;return b(r,{left:n-a/2,top:o-l/2}),r}},{key:"updateLink",value:function(n){var $=this;this.connections.filter(function(t){var e=t.fromNode,i=t.toNode;return e===n||i===n}).forEach(function(t){var e,i,n=t.fromNode,o=t.toNode,r=t.line,s=t.labelEl,a=$.getNodeBound(n),l=$.getNodeBound(o),h=a.left,c=a.right,u=a.top,d=a.bottom,f=a.width,p=a.height,g=l.left,v=l.right,m=l.top,y=l.bottom,k=l.width,b=l.height,w=ht(a,l);if(!w)return r.clear(),void C(s,"mind-hidden");i="horizontal"===w?(e=v<h?[h,u+p/2]:[c,u+p/2],v<h?[v,m+b/2]:[g,m+b/2]):(e=y<u?[h+f/2,u]:[h+f/2,d],y<u?[g+k/2,y]:[g+k/2,m]),r.update({from:e,to:i,direction:w}),s&&$.updateLabel(s,e,i)})}},{key:"updateLabel",value:function(t,e,i){var n=t.getBoundingClientRect(),o=n.width,r=n.height;M(t,"mind-hidden"),b(t,{left:(e[0]+i[0]-o)/2,top:(e[1]+i[1]-r)/2})}},{key:"updateAllLabelPosition",value:function(){var n=this;this.connections.forEach(function(t){var e=t.labelEl,i=t.line;e&&n.updateLabel(e,i.from,i.to)})}},{key:"initEvents",value:function(){Q(lt).on("click.node",".mind-node",this.onNodeClick.bind(this)),this.options.draggable&&Q(this.$viewport).on("mousedown.nodedrag",".mind-node.draggable",this.onNodeDragStart.bind(this))}},{key:"onNodeClick",value:function(t){if(!this.isNodeDragging){var e=this.options.onNodeClick,i=this.getNodeByChildElement(t.target);i&&e&&e(i.config,i)}}},{key:"onNodeDragStart",value:function(t){t.stopPropagation();var e=this.draggingNode=this.getNodeByChildElement(t.target);e.setDrag(!0),this.originNodePos=e.getPosition(),this.dragStartPos={x:t.pageX,y:t.pageY},Q(this.$viewport).on("mousemove.nodedrag",this.onNodeDragging.bind(this)),Q(lt).on("mouseup.nodedrag",this.onNodeDragEnd.bind(this))}},{key:"onNodeDragging",value:function(t){t.stopPropagation(),this.draggingNode&&(this.isNodeDragging=!0,this.draggingNode.setStyle({left:this.originNodePos.left+t.pageX-this.dragStartPos.x,top:this.originNodePos.top+t.pageY-this.dragStartPos.y,zIndex:1}),this.updateLink(this.draggingNode))}},{key:"onNodeDragEnd",value:function(){var t=this;this.draggingNode&&(this.draggingNode.setDrag(!1),this.draggingNode=null,Q(this.$viewport).off("mousemove.nodedrag"),Q(lt).off("mouseup.nodedrag"),setTimeout(function(){t.isNodeDragging=!1}))}},{key:"getNodeBound",value:function(t){var e=t.node||t,i=e.getBoundRect(),n=i.width,o=i.height,r=parseInt(e.$el.style.left,10),s=parseInt(e.$el.style.top,10);return{width:n,height:o,left:r,top:s,right:r+n,bottom:s+o}}},{key:"getNodeByChildElement",value:function(t){for(;!$(t,"mind-node");)t=t.parentNode;return this.getNodeByElement(t)}},{key:"getNodeByElement",value:function(e){var t=this.nodes.find(function(t){return t.node.$el===e});return t&&t.node}},{key:"showLabel",value:function(){M(this.$el,"mind-label-hide"),this.options.draggable&&this.updateAllLabelPosition()}},{key:"hideLabel",value:function(){C(this.$el,"mind-label-hide")}}]),n}();return R.Org=rt,R.Flow=ct,R.defaults=P,R.Node=F,R});
//# sourceMappingURL=mind.min.js.map
