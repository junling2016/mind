!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Mind=e()}(this,function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?h(t):e}function u(t,e){var n=t.listenerMap;return!n&&e&&(n=t.listenerMap={}),n}function d(t,e){var n=u(t);return n&&n[e]}function f(t,e){var n=u(t);n&&delete n[e]}function p(t){return t.split(".")[0]}function v(e,t){var n=d(e,t),i=p(t);if(n){n.forEach(function(t){e.removeEventListener(i,t)}),f(e,t);var o=u(e);Object.keys(o).length||delete e.listenerMap}}function g(t,e,n){var i=p(e);t.addEventListener(i,n);var o=u(t,!0),r=o[e];r||(r=o[e]=[]),r.push(n)}function m(t,e,n){u(t)&&(n?function(t,e,n){var i=p(e);t.removeEventListener(i,n);var o=d(t,e);if(o){var r=o.findIndex(function(t){return t===n});-1!==r&&o.splice(r,1),o.length||f(t,e)}}(t,e,n):e?v(t,e):function(t){var e=u(t);if(e)for(var n in e)v(t,n)}(t))}var y=document,k=("undefined"==typeof HTMLElement||e(HTMLElement),["width","height","fontSize","borderRadius","padding","left","right","top","bottom","borderWidth","maxWidth"]),w=function(t,e){for(var n in e)"padding"===n?t.style.padding="".concat(e.padding[0],"px ").concat(e.padding[1],"px"):t.style[n]=k.includes(n)?"".concat(e[n],"px"):e[n]},b=["svg","g","path"],L=function(t,e,n){var i;for(var o in i=b.includes(t)?y.createElementNS("http://www.w3.org/2000/svg",t):y.createElement(t),e)i.setAttribute(o,e[o]);return n&&n.appendChild(i),i},$=function(t,e){return t.className.split(" ").includes(e)},C=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";if(e){var n=e.className;t.split(" ").forEach(function(t){t&&(e.classList?e.classList.add(t):$(e,t)||(n+=" "+t))}),e.classList||(e.className=n)}},x=function(t,e){if(t&&e){for(var n=e.split(" "),i=" "+t.className+" ",o=0,r=n.length;o<r;o++){var s=n[o];s&&(t.classList?t.classList.remove(s):$(t,s)&&(i=i.replace(" "+s+" "," ")))}t.classList||(t.className=trim(i))}},M=document,t=function(){function e(t){o(this,e),a(this,"root",null),a(this,"$container",null),a(this,"$el",null),a(this,"options",null),a(this,"scale",1),a(this,"dragingFlag",!1),this.root=t,this.$container=t.$el,this.options=t.options,this.create(),this.setStyle(),this.moveToCenter(),this.initEvents()}return r(e,[{key:"create",value:function(){this.$el=L("div",{class:"mind-designer"},this.$container)}},{key:"setStyle",value:function(){var t=this.options,e=t.width,n=t.height,i=t.backgroundColor;w(this.$el,{width:e,height:n,backgroundColor:i})}},{key:"moveTo",value:function(t,e){this.$container.scrollLeft=t,this.$container.scrollTop=e}},{key:"moveToCenter",value:function(){var t=this.$container.getBoundingClientRect(),e=t.width,n=t.height,i=this.options,o=i.width,r=i.height;this.moveTo((o-e)/2,(r-n)/2)}},{key:"initEvents",value:function(){g(this.$el,"mousedown.dragmove",this.onDragStart.bind(this))}},{key:"onDragStart",value:function(t){var e=t.pageX,n=t.pageY,i=this.$container,o=i.scrollLeft,r=i.scrollTop;this.dragStartMousePosition={pageX:e,pageY:n},this.dragStartScroll={scrollLeft:o,scrollTop:r},g(M,"mousemove.dragmove",this.onDraging.bind(this)),g(M,"mouseup.dragmove",this.onDragEnd.bind(this))}},{key:"onDraging",value:function(t){var e=this.dragStartScroll,n=e.scrollLeft,i=e.scrollTop,o=this.dragStartMousePosition,r=o.pageX,s=o.pageY,a=n-t.pageX+r,l=i-t.pageY+s;this.moveTo(a,l),this.dragingFlag||(C(this.$el,"mind-no-event"),this.dragingFlag=!0)}},{key:"onDragEnd",value:function(t){t.stopPropagation(),m(M,"mousemove.dragmove"),m(M,"mouseup.dragmove"),this.dragingFlag=!1,x(this.$el,"mind-no-event")}},{key:"zoom",value:function(t){this.scale=t||1,w(this.$el,{transform:"scale(".concat(this.scale,")")})}},{key:"zoomIn",value:function(){var t=this.options,e=t.zoomMax,n=t.zoomStep;this.zoom(Math.min(this.scale+n,e))}},{key:"zoomOut",value:function(){var t=this.options,e=t.zoomMin,n=t.zoomStep;this.zoom(Math.max(this.scale-n,e))}},{key:"getZoom",value:function(){return this.scale}}]),e}(),T={lineColor:["#FDB813","#80BC42","#e85d4e","#127c97","#ffcccc","#67ccff"],type:"org",width:2e4,height:2e4,nodeDragEnable:!1,showConnectionLabel:!0,showTooltip:!0,tooltipDelay:500,formatTooltip:null,backgroundColor:"#fff",zoomMax:2,zoomMin:.4,zoomStep:.15,rootMargin:80,branchMargin:20,branchShowIndex:!1,flowNodeMarginW:200,flowNodeMarginH:60,flowRootMargin:200,normalLineStyle:{stroke:"rgb(58, 169, 206)",strokeWidth:1,strokeLinecap:"square",fill:"none"},linkLineStyle:{stroke:"rgb(113, 203, 45)",strokeWidth:2,strokeLinecap:"square",strokeLinejoin:"round",fill:"none"},onNodeClick:null};"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var E,S,P,N,B=(function(t,e){t.exports=function(){var s=function(t){return!(!(i=t)||"object"!=typeof i||(e=t,"[object RegExp]"===(n=Object.prototype.toString.call(e))||"[object Date]"===n||e.$$typeof===o));var e,n,i},o="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function a(t,e){return!1!==e.clone&&e.isMergeableObject(t)?r((n=t,Array.isArray(n)?[]:{}),t,e):t;var n}function l(t,e,n){return t.concat(e).map(function(t){return a(t,n)})}function h(e,n,i){var o={};return i.isMergeableObject(e)&&Object.keys(e).forEach(function(t){o[t]=a(e[t],i)}),Object.keys(n).forEach(function(t){i.isMergeableObject(n[t])&&e[t]?o[t]=function(t,e){if(!e.customMerge)return r;var n=e.customMerge(t);return"function"==typeof n?n:r}(t,i)(e[t],n[t],i):o[t]=a(n[t],i)}),o}function r(t,e,n){(n=n||{}).arrayMerge=n.arrayMerge||l,n.isMergeableObject=n.isMergeableObject||s;var i=Array.isArray(e),o=Array.isArray(t),r=i===o;return r?i?n.arrayMerge(t,e,n):h(t,e,n):a(e,n)}return r.all=function(t,n){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce(function(t,e){return r(t,e,n)},{})},r}()}(E={exports:{}},E.exports),E.exports),j=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e=e.filter(function(t){return!!t}),B.all(e,{arrayMerge:function(t,e){return e}})},z=("undefined"==typeof HTMLElement||e(HTMLElement),document.body),O=0,D=0,A=function(){S||(S=L("div",{class:"mind-tooltip"}),z.appendChild(S))},W=function(){if(S){var t=S.getBoundingClientRect(),e=t.width,n=t.height;w(S,{left:O-e/2,top:D-n-4})}},R=function(){S&&(z.removeChild(S),S=null)},_=document,G=function(){function n(t,e){o(this,n),a(this,"$container",null),a(this,"$el",null),a(this,"options",T),a(this,"viewport",null),this.$container="string"==typeof t?_.querySelector(t):t,this.options=j(this.options,e),this.create(),this.createViewport()}return r(n,[{key:"create",value:function(){this.$el=L("div",{class:"mind-container"},this.$container)}},{key:"createViewport",value:function(){this.viewport=new t(this)}},{key:"getViewportSize",value:function(){var t=this.options;return{width:t.width,height:t.height}}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"destroy",value:function(){this.$container.removeChild(this.$el),R()}}]),n}(),q=function(){function e(t){o(this,e),a(this,"$el",null),a(this,"$expandBox",null),a(this,"options",{nodeType:"normal",data:null,showTooltip:!1,formatTooltip:null,tooltipDelay:0}),this.options=j(this.options,t),this.create(),this.setStyle(),this.initEvents()}return r(e,[{key:"create",value:function(){var t=this.options.data.title;this.$el=L("div",{class:"mind-node"}),L("div",{class:"mind-node-inner"},this.$el).innerText=t}},{key:"setStyle",value:function(){var t=this.options,e=(t.nodeType,t.data);w(this.$el,e.style),e.className&&C(this.$el,e.className)}},{key:"initEvents",value:function(){g(this.$el,"mouseenter.nodehover",this.onMouseEnter.bind(this)),g(this.$el,"mouseleave.nodehover",this.onMouseLeave.bind(this))}},{key:"onMouseEnter",value:function(){var t=this.options,e=t.data,n=t.showTooltip,i=t.formatTooltip,o=t.tooltipDelay;if(n){var r=i?i(e,this):e.title;if(r){var s,a,l=this.getSize(),h=l.width,c=l.left,u=l.top;s=r,S||A(),S.innerHTML=s,O=c+h/2,D=u,a=o,S||A(),a?P=setTimeout(function(){C(S,"show"),W()},a):(C(S,"show"),W())}}}},{key:"onMouseLeave",value:function(){S&&(P&&(clearTimeout(P),P=null),x(S,"show"),S.style.left="",S.style.top="")}},{key:"getSize",value:function(){return this.$el.getBoundingClientRect()}},{key:"getData",value:function(){return this.options.data}},{key:"setPosition",value:function(t,e){w(this.$el,{left:t,top:e})}},{key:"remove",value:function(){this.container&&this.container.removeChild(this.el)}}]),e}(),X=function(){function e(t){o(this,e),a(this,"$el",null),a(this,"options",{start:[],end:[],radius:4,stroke:"#43a9ff",strokeWidth:1,fill:"none",strokeLinecap:"square"}),Object.assign(this.options,t),this.create()}return r(e,[{key:"create",value:function(){var t,e=this.options,n=e.start,i=e.end,o=e.radius,r=e.stroke,s=e.strokeWidth,a=e.strokeLinecap,l=e.fill,h=n[0],c=n[1],u=i[0],d=i[1];if(Math.abs(c-d)<o)t=["M",h,c,"L",u,d];else{var f=h<u&&d<c||u<h&&c<d?1:0,p=(h+u)/2,v=h<u?Math.min(p+o,u):Math.max(p-o,u);t=["M",h,c,"L",p,c,"L",p,c<d?Math.max(c,d-o):Math.min(c,d+o),"A",o,o,0,0,f,v,d,"L",u,d]}this.$el=L("path",{d:t.join(" "),stroke:r,"stroke-width":s,"stroke-linecap":a,fill:l})}}]),e}(),Z=function(){function s(t){o(this,s),a(this,"options",{mind:null,parent:null,structure:"right",data:null}),a(this,"mind",null),a(this,"$el",null),a(this,"$topicBox",null),a(this,"$expandBox",null),a(this,"$pathBox",null),a(this,"$pathGroup",null),a(this,"node",null),a(this,"parent",null),a(this,"children",[]),a(this,"isExpand",!0),Object.assign(this.options,t),this.parent=this.options.parent,this.mind=this.options.mind,this.isExpand=!1!==t.data.expand,this.create()}return r(s,[{key:"render",value:function(){var t=this.children;t.length&&(this.isExpand&&this.drawLines(),t.forEach(function(t){t.render()}))}},{key:"create",value:function(){var t=this.options,e=t.data,n=t.structure;this.$el=L("div",{class:"mind-topic-container mind-topic-".concat(n," ").concat(this.isExpand?"is-expand":"")}),this.createNode(),e.children&&e.children.length&&(this.createChildren(),this.createPaths(),this.createExpand())}},{key:"createNode",value:function(){var t=this.parent,e=this.options,n="normal",i=this.$topicBox=L("div",{class:"mind-topic-box"},this.$el);"root"===e.structure?n="root":t&&"root"===t.options.structure&&(n="branch"),this.node=new q({nodeType:n,data:e.data,showTooltip:this.mind.options.showTooltip,formatTooltip:this.mind.options.formatTooltip,tooltipDelay:this.mind.options.tooltipDelay}),i.appendChild(this.node.$el)}},{key:"createExpand",value:function(){this.$expandBox=L("span",{class:"mind-expand-box"},this.$topicBox)}},{key:"createChildren",value:function(){var n=this,t=this.options,e=t.data,i=t.structure,o=e.children,r=L("div",{class:"mind-topic-children"});this.children=o.map(function(t){var e=new s({mind:n.mind,parent:n,structure:i,data:t});return r.appendChild(e.$el),e}),"left"===i?this.$el.insertBefore(r,this.$topicBox):this.$el.appendChild(r)}},{key:"createPaths",value:function(){var t=this.$pathBox=L("svg",{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},this.$el);this.$pathGroup=L("g",null,t)}},{key:"setPosition",value:function(t,e){w(this.$el,{left:t,top:e})}},{key:"getPosition",value:function(){return{left:parseInt(this.$el.style.left,10),top:parseInt(this.$el.style.top,10)}}},{key:"getSize",value:function(){return this.$el.getBoundingClientRect()}},{key:"drawLines",value:function(){var r=this,s=this.mind.getZoom(),a=this.options.structure,l=this.getSize(),h=this.getLineStartPos();this.children.forEach(function(t){var e=t.getSize(),n=(e.top-l.top+e.height/2)/s,i=("left"===a?e.right-l.left:e.left-l.left)/s,o=new X({start:[h.left/s,h.top/s],end:[i,n]});r.$pathGroup.appendChild(o.$el)})}},{key:"updateConnections",value:function(){this.children.length&&(this.$pathGroup.innerHTML="",this.isExpand&&this.drawLines())}},{key:"updateParentConnections",value:function(){var t=this.parent;t&&(t.updateConnections(),t.updateParentConnections())}},{key:"updateChildConnections",value:function(){this.children.forEach(function(t){t.updateConnections(),t.updateChildConnections()})}},{key:"getLineStartPos",value:function(){var t=this.options.structure,e=this.getSize(),n=this.node.getSize(),i=n.top-e.top+n.height/2;return{left:"left"===t?n.left-e.left:n.left-e.left+n.width,top:i}}},{key:"triggerExpand",value:function(){this.isExpand=!this.isExpand,this.isExpand?C(this.$el,"is-expand"):x(this.$el,"is-expand"),this.getRootTopic().resetPosToCenter(),this.updateParentConnections(),this.updateConnections(),this.updateChildConnections()}},{key:"getRootTopic",value:function(){for(var t=this;t.parent;)t=t.parent;return t}}]),s}(),H=function(){function e(t){o(this,e),a(this,"$el",null),a(this,"options",{type:"quadratic",start:[],end:[],quadraticWidth:10,stroke:"#43a9ff",strokeWidth:2,fill:"none",strokeLinecap:"square"}),Object.assign(this.options,t),this.create()}return r(e,[{key:"create",value:function(){switch(this.options.type){case"gradient":this.createGradientCurve()}}},{key:"createGradientCurve",value:function(){var t,e=this.options,n=e.start,i=e.end,o=e.quadraticWidth,r=e.stroke,s=e.strokeWidth,a=e.strokeLinecap,l=e.fill,h=n[0],c=n[1],u=i[0],d=i[1];if(Math.abs(d-c)<o){var f=Math.atan((d-c)/(u-h)),p=Math.sin(f)*o/2,v=Math.cos(f)*o/2,g=h+p,m=c-v;t=["M",g,m,"L",u,d,"L",h-p,c+v,"L",g,m]}else{var y=.2*(u-h)+h,k=d,w=h<u&&c<d||u<h&&d<c?-o:o,b=Math.atan((k-c)/(y-h)),$=Math.sin(b)*o/2,C=Math.cos(b)*o/2,x=h+$,M=c-C,T=h-$,E=c+C;t=["M",x,M,"C",x,M,y,k,u,d,"C",y+w,k,T,E,T,E,"L",x,M,"Z"]}this.$el=L("path",{d:t.join(" "),stroke:r,"stroke-width":s,"stroke-linecap":a,fill:l})}}]),e}(),Y=function(t){function n(t){var e;return o(this,n),a(h(e=c(this,l(n).call(this,t))),"centerPosX",null),a(h(e),"centerPosY",null),e}return s(n,Z),r(n,[{key:"createChildren",value:function(){var t=this.options.data,e=t.children,n=t.leftChildren,i=L("div",{class:"mind-topic-children"}),o=this.createChildrenByStructure(e,"right",i),r=this.createChildrenByStructure(n,"left",i);this.children=o.concat(r),this.$el.appendChild(i)}},{key:"createChildrenByStructure",value:function(t,n,i){var o=this;return t?t.map(function(t){var e=new Z({mind:o.mind,parent:o,structure:n,data:t});return i.appendChild(e.$el),e}):[]}},{key:"render",value:function(){this.mind.viewport.$el.appendChild(this.$el),this.resetPosToCenter(),this.drawLines(),this.children.forEach(function(t){t.render()})}},{key:"resetPosToCenter",value:function(){this.resetNodePos(),this.resetChildTopicPos("left"),this.resetChildTopicPos("right")}},{key:"resetNodePos",value:function(){var t=this.mind.getZoom(),e=this.node.getSize(),n=e.width,i=e.height,o=this.mind.getViewportSize(),r=o.width,s=o.height,a=(r-n/t)/2,l=(s-i/t)/2;this.centerPosX=r/2,this.centerPosY=s/2,w(this.$topicBox,{left:a,top:l})}},{key:"resetChildTopicPos",value:function(o){var r=this,s=this.mind.getZoom(),a=this.node.getSize().width,t=this.mind.options,l=t.rootMargin,h=t.branchMargin,c=this.children.filter(function(t){return t.options.structure===o}),e=c.map(function(t){return t.getSize()}),n=e.reduce(function(t,e){return t+e.height/s},0);n+=(c.length-1)*h;var u=this.centerPosY-n/2;e.forEach(function(t,e){var n=c[e],i="left"===o?r.centerPosX-a/s/2-l-t.width/s:r.centerPosX+a/s/2+l;n.setPosition(i,u),u+=t.height/s+h})}},{key:"drawLines",value:function(){var c=this,u=this.mind.getZoom(),d=this.centerPosX,f=this.centerPosY,p=this.mind.options.lineColor;this.children.forEach(function(t,e){var n=t.getSize(),i=n.width,o=n.height,r=t.getPosition(),s=r.left,a=r.top,l="left"===t.options.structure?s+i/u:s,h=new H({type:"gradient",start:[d,f],end:[l,a+o/u/2],stroke:p[e],fill:p[e]});c.$pathGroup.appendChild(h.$el)})}}]),n}(),I=0,F=0,V={},J={};function K(t,e,n){return"_root"==e?n:t!==n?(i=t,N||(N=i.matches?i.matches:i.webkitMatchesSelector?i.webkitMatchesSelector:i.mozMatchesSelector?i.mozMatchesSelector:i.msMatchesSelector?i.msMatchesSelector:i.oMatchesSelector?i.oMatchesSelector:tt.matchesSelector)).call(t,e)?t:t.parentNode?(I++,K(t.parentNode,e,n)):void 0:void 0;var i}function Q(t,e,n,i){if(V[t.id])if(e)if(i||n)if(i){if(V[t.id][e][n])for(var o=0;o<V[t.id][e][n].length;o++)if(V[t.id][e][n][o]===i){V[t.id][e][n].splice(o,1);break}}else delete V[t.id][e][n];else V[t.id][e]={};else for(var r in V[t.id])V[t.id].hasOwnProperty(r)&&(V[t.id][r]={})}function U(t,e,n,i){if(this.element){t instanceof Array||(t=[t]),n||"function"!=typeof e||(n=e,e="_root");var o,r,s,a,l,h=this.id;for(o=0;o<t.length;o++)i?Q(this,t[o],e,n):(V[h]&&V[h][t[o]]||tt.addEvent(this,t[o],c(t[o])),r=this,s=t[o],a=e,l=n,V[r.id]||(V[r.id]={}),V[r.id][s]||(V[r.id][s]={}),V[r.id][s][a]||(V[r.id][s][a]=[]),V[r.id][s][a].push(l));return this}function c(e){return function(t){!function(t,e,n){if(V[t][n]){var i,o,r=e.target||e.srcElement,s={},a=0,l=0;for(i in I=0,V[t][n])V[t][n].hasOwnProperty(i)&&(o=K(r,i,J[t].element))&&tt.matchesEvent(n,J[t].element,o,"_root"==i,e)&&(I++,V[t][n][i].match=o,s[I]=V[t][n][i]);for(e.stopPropagation=function(){e.cancelBubble=!0},a=0;a<=I;a++)if(s[a])for(l=0;l<s[a].length;l++){if(!1===s[a][l].call(s[a].match,e))return tt.cancel(e);if(e.cancelBubble)return}}}(h,t,e)}}}function tt(t,e){if(!(this instanceof tt)){for(var n in J)if(J[n].element===t)return J[n];return J[++F]=new tt(t,F),J[F]}this.element=t,this.id=e}tt.prototype.on=function(t,e,n){return U.call(this,t,e,n)},tt.prototype.off=function(t,e,n){return U.call(this,t,e,n,!0)},tt.matchesSelector=function(){},tt.cancel=function(t){t.preventDefault(),t.stopPropagation()},tt.addEvent=function(t,e,n){var i="blur"==(e=e.split(".")[0])||"focus"==e;t.element.addEventListener(e,n,i)},tt.matchesEvent=function(){return!0};var et=document,nt=function(t){function i(t,e){var n;return o(this,i),a(h(n=c(this,l(i).call(this,t,e))),"rootTopic",null),a(h(n),"topics",[]),n.initEvents(),n.render(),n}return s(i,G),r(i,[{key:"render",value:function(){this.rootTopic=new Y({mind:this,structure:"root",data:this.options.data}),this.rootTopic.render(),this.topics=function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"children",i=[];return t instanceof Array?t.forEach(function(t){i.push(t),i=i.concat(e(t[n]))}):(i.push(t),i=i.concat(e(t[n]))),i}(this.rootTopic)}},{key:"initEvents",value:function(){tt(et).on("click.expand",".mind-expand-box",this.triggerTopicExpand.bind(this)),tt(et).on("click.node",".mind-node",this.onNodeClick.bind(this))}},{key:"triggerTopicExpand",value:function(t){var e=t.target.parentNode.parentNode,n=this.getTopicByElement(e);n&&n.triggerExpand()}},{key:"onNodeClick",value:function(t){for(var e=t.target;!$(e,"mind-topic-container");)e=e.parentNode;var n=this.getTopicByElement(e);n&&this.options.onNodeClick&&this.options.onNodeClick(n.options.data,n.node)}},{key:"getTopicByElement",value:function(e){return this.topics.find(function(t){return t.$el===e})}},{key:"destroy",value:function(){this.$container.removeChild(this.$el),tt(et).off("click.expand"),tt(et).off("click.node"),R()}}]),i}(),it=function(){function i(t,e,n){o(this,i),a(this,"$path",null),a(this,"from",null),a(this,"to",null),a(this,"options",{stroke:"#43a9ff",strokeWidth:1,strokeLinecap:"square",fill:"none"}),this.from=t,this.to=e,Object.assign(this.options,n),this.create()}return r(i,[{key:"create",value:function(){var t=this.options,e=t.stroke,n=t.strokeWidth,i=t.strokeLinecap,o=t.fill,r=this.$path=L("path",{stroke:e,"stroke-width":n,"stroke-linecap":i,fill:o});this.getPath&&r.setAttribute("d",this.getPath())}}]),i}(),ot=function(t){function i(t,e,n){return o(this,i),c(this,l(i).call(this,t,e,n))}return s(i,it),r(i,[{key:"create",value:function(){var t=this.options,e={stroke:t.stroke,"stroke-width":t.strokeWidth,"stroke-linecap":t.strokeLinecap,"stroke-linejoin":t.strokeLinejoin,fill:t.fill},n=this.$path=L("g"),i=L("path",e,n),o=L("path",e,n);i.setAttribute("d",this.getPath()),o.setAttribute("d",this.getArrowPath())}},{key:"getPath",value:function(){var t=this.from[0],e=this.from[1],n=this.to[0],i=this.to[1],o=.4*Math.abs(t-n);return["M",t,e,"C",n<t?t-o:t+o,e,n<t?n+o:n-o,i,n<t?n+10:n-10,i,"L",n,i].join(" ")}},{key:"getArrowPath",value:function(){var t,e,n=this.from[0],i=this.to[0],o=this.to[1];return e=i<n?(t=[i+6,o-4],[i+6,o+4]):(t=[i-6,o-4],[i-6,o+4]),["M",i,o,"L",t[0],t[1],"M",i,o,"L",e[0],e[1],"Z"].join(" ")}}]),i}(),rt=document,st=function(t){function i(t,e){var n;return o(this,i),a(h(n=c(this,l(i).call(this,t,e))),"nodes",[]),a(h(n),"nodeTree",null),a(h(n),"$pathBox",null),a(h(n),"$pathGroup",null),C(n.$el,"mind-flow"),n.nodeTree=n.createNode(e.data,0),n.nodes.forEach(function(t){var e=t.node;n.viewport.$el.appendChild(e.$el)}),n.createPaths(),n.createLabels(),n.setPosition(),n.createConnections(n.nodeTree),n.initEvents(),n}return s(i,G),r(i,[{key:"createNode",value:function(t,o){var r=this;if(t){if(t instanceof Array)return t.map(function(t){var e=r.createNode(t.parents,o-1),n=r.createNode(t.children,o+1),i={node:new q({nodeType:"flow",data:t,showTooltip:r.options.showTooltip,formatTooltip:r.options.formatTooltip,tooltipDelay:r.options.tooltipDelay}),axis:o,parents:e,children:n};return e&&e.length?i.leaf=e.reduce(function(t,e){return t+e.leaf},0):n&&n.length?i.leaf=n.reduce(function(t,e){return t+e.leaf},0):i.leaf=1,r.nodes.push(i),i});var e={node:new q({nodeType:"root",data:t,showTooltip:this.options.showTooltip,formatTooltip:this.options.formatTooltip,tooltipDelay:this.options.tooltipDelay}),axis:o,parents:this.createNode(t.parents,o-1),children:this.createNode(t.children,o+1)};return this.nodes.push(e),e}}},{key:"createPaths",value:function(){var t=this.$pathBox=L("svg",{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},this.viewport.$el);this.$pathGroup=L("g",null,t)}},{key:"createLabels",value:function(){this.$labelContainer=L("div",{class:"mind-label-container"},this.viewport.$el)}},{key:"setPosition",value:function(){var t=this.options,e=t.width,n=t.height,i=this.nodeTree.node,o=i.getSize(),r=o.width,s=o.height,a=e/2,l=n/2;i.setPosition(a-r/2,l-s/2),this.setNodePosition(this.nodeTree.parents,"left",l),this.setNodePosition(this.nodeTree.children,"right",l)}},{key:"setNodePosition",value:function(t,l,h){var c=this,e=this.options,n=e.width,u=e.flowRootMargin,d=e.flowNodeMarginW,f=e.flowNodeMarginH;if(t&&t.length){var p=n/2,v=t.reduce(function(t,e){return e.leaf+t},0),g=0;t.forEach(function(t){var e,n=c.nodeTree.node.getSize().width,i=t.node.getSize(),o=i.width,r=i.height,s="left"===l?t.parents:t.children,a=h-(v/2-t.leaf/2-g)*f-r/2;e="left"===l?p-((Math.abs(t.axis)-1)*d+u+o/2)-n/2:p+((Math.abs(t.axis)-1)*d+u-o/2)+n/2,t.node.setPosition(e,a),g+=t.leaf,c.setNodePosition(s,l,a+r/2)})}}},{key:"createConnections",value:function(i){var o=this,t=i.children,e=i.parents,r=this.getNodeBound(i);t&&t.forEach(function(t){var e=t.node.options.data.connectionLabel,n=o.getNodeBound(t);o.drawLink(r,n,e),o.createConnections(t)}),e&&e.forEach(function(t){var e=i.node.options.data.connectionLabel,n=o.getNodeBound(t);o.drawLink(n,r,e),o.createConnections(t)})}},{key:"drawLink",value:function(t,e,n){var i=this.options,o=i.linkLineStyle,r=i.showConnectionLabel,s=[t.left+t.width,t.top+t.height/2],a=[e.left,e.top+e.height/2],l=new ot(s,a,o);this.$pathGroup.appendChild(l.$path),r&&n&&this.drawLabel(t,e,n)}},{key:"drawLabel",value:function(t,e,n){var i=(t.left+t.width+e.left)/2,o=(t.top+t.height/2+e.top+e.height/2)/2,r=L("div",{class:"mind-label"},this.$labelContainer);r.innerText=n;var s=r.getBoundingClientRect(),a=s.width,l=s.height;w(r,{left:i-a/2,top:o-l/2})}},{key:"initEvents",value:function(){tt(rt).on("click.node",".mind-node",this.onNodeClick.bind(this))}},{key:"onNodeClick",value:function(t){for(var e=this.options.onNodeClick,n=t.target;!$(n,"mind-node");)n=n.parentNode;var i=this.getNodeByElement(n);i&&e&&e(i.options.data,i)}},{key:"getNodeBound",value:function(t){var e=t.node,n=e.getSize(),i=n.width,o=n.height,r=e.$el.style,s=r.left,a=r.top;return{width:i,height:o,left:parseInt(s,10),top:parseInt(a,10)}}},{key:"getNodeByElement",value:function(e){var t=this.nodes.find(function(t){return t.node.$el===e});return t&&t.node}}]),i}();return G.Org=nt,G.Flow=st,G.defaults=T,G});
//# sourceMappingURL=mind.min.js.map
